{% extends "base.html" %}

{% block title %}Game Night Tracker - Admin Teams{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/teams.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Team Management</h1>
    {% if current_user.is_authenticated %}
    <a href="{{ url_for('admin.add_team') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add New Team
    </a>
    {% endif %}
</div>

<div class="card">
    <div class="team-actions">
        <div class="search">
            <input type="text" id="teamSearch" placeholder="Search teams..." onkeyup="filterTeams()">
        </div>
        <div class="team-count">
            <span>{{ teams|length }} teams total</span>
        </div>
    </div>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="team-table">
        <table id="teamsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Team Name</th>
                    <th>Participants</th>
                    <th>Points</th>
                    <th>Games Played</th>
                    {% if current_user.is_authenticated %}
                    <th class="actions-column">Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for team in teams %}
                <tr>
                    <td>{{ team.id }}</td>
                    <td class="team-name">
                        <div class="team-name-with-color">
                            <div class="team-color-indicator" style="background-color: {{ team.color or '#3b82f6' }};"></div>
                            <span>{{ team.name }}</span>
                        </div>
                    </td>
                    <td>
                        {% for participant in team.participants %}
                            <div class="participant">{{ participant.getFullName() }}</div>
                        {% endfor %}
                    </td>
                    <td class="points-cell">{{ team.totalPoints }}</td>
                    <td>{{ team.games_played }}</td>
                    {% if current_user.is_authenticated %}
                    <td class="actions">
                        <div class="btn-group">
                            <a href="{{ url_for('admin.edit_team', team_id=team.id) }}" class="btn btn-sm btn-primary" title="Edit Team">
                                Edit
                            </a>
                            <button class="btn btn-sm btn-danger" title="Delete Team"
                                    onclick="confirmDelete({{ team.id }}, '{{ team.name }}')">
                                Delete
                            </button>
                        </div>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Delete Confirmation Modal -->
{% if current_user.is_authenticated %}
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Confirm Deletion</h2>
        <p>Are you sure you want to delete the team "<span id="teamToDelete"></span>"?</p>
        <p class="warning">This action cannot be undone and will remove all participant and score data associated with this team.</p>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <form id="deleteForm" method="POST" action="">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-danger">Delete Team</button>
            </form>
        </div>
    </div>
</div>
{% endif %}






<script src="{{ url_for('static', filename='js/teams.js') }}"></script>
{% endblock %}